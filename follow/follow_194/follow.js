//~ Revision: 194, Copyright (C) 2016-2017: Willem Vree, contributions St√©phane David.
//~ This program is free software; you can redistribute it and/or modify it under the terms of the
//~ GNU General Public License as published by the Free Software Foundation; either version 2 of
//~ the License, or (at your option) any later version.
//~ This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
//~ without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
//~ See the GNU General Public License for more details. <http://www.gnu.org/licenses/gpl.html>.
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(f,y,u){if(u.get||u.set)throw new TypeError("ES3 does not support getters and setters.");f!=Array.prototype&&f!=Object.prototype&&(f[y]=u.value)};$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(f){return $jscomp.SYMBOL_PREFIX+(f||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.iterator;f||(f=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[f]&&$jscomp.defineProperty(Array.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(f){var y=0;return $jscomp.iteratorPrototype(function(){return y<f.length?{done:!1,value:f[y++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(f){$jscomp.initSymbolIterator();f={next:f};f[$jscomp.global.Symbol.iterator]=function(){return this};return f};$jscomp.iteratorFromArray=function(f,y){$jscomp.initSymbolIterator();f instanceof String&&(f+="");var u=0,B={next:function(){if(u<f.length){var F=u++;return{value:y(F,f[F]),done:!1}}B.next=function(){return{done:!0,value:void 0}};return B.next()}};B[Symbol.iterator]=function(){return B};return B};
$jscomp.polyfill=function(f,y,u,B){if(y){u=$jscomp.global;f=f.split(".");for(B=0;B<f.length-1;B++){var F=f[B];F in u||(u[F]={});u=u[F]}f=f[f.length-1];B=u[f];y=y(B);y!=B&&null!=y&&$jscomp.defineProperty(u,f,{configurable:!0,writable:!0,value:y})}};$jscomp.polyfill("Array.prototype.keys",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(f){return f})}},"es6-impl","es3");
$jscomp.findInternal=function(f,y,u){f instanceof String&&(f=String(f));for(var B=f.length,F=0;F<B;F++){var da=f[F];if(y.call(u,da,F,f))return{i:F,v:da}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(f){return f?f:function(f,u){return $jscomp.findInternal(this,f,u).v}},"es6-impl","es3");$jscomp.polyfill("Math.log10",function(f){return f?f:function(f){return Math.log(f)/Math.LN10}},"es6-impl","es3");var follow_VERSION=194,pre_opt={},abc_arr,demoDlg,media_file;
(function(){function f(a,b,c){var d=D.createBufferSource();d.buffer=kc[a];var g=D.createGain();g.gain.value=tb*b/50;d.connect(g);g.connect(D.destination);d.start(c,.06);ub[a]=d;delete Ua[a]}function y(a,b){var c=ub[a];c&&(vb?Ua[a]=1:(c.stop(b),ub[a]=void 0))}function u(a){var b="C Db D Eb E F Gb G Ab A Bb B".split(" "),c=a.shift();c?(b=MIDI.Soundfont.acoustic_grand_piano[b[c%12]+(Math.floor(c/12)-1)].split(",")[1],lc(b,function(b){kc[c]=b;$("#comp").append(", "+c);wb.push(""+c);mc[c]=1;u(a)})):(ea=
1,q("midi nrs: "+wb.join(",")),xb||!U?$("#comp").toggle(!1):$("#comp").append("<br>waiting for sufficient audio data ..."))}function B(a){function b(){$("#comp").toggle(!0);D.resume().then(function(){q("audio unlocked");wb=[];u(d)},function(){$("#comp").append("Unlock audio context failed ...");ea=0});xa&&v.play().then(function(){v.currentTime=yb+Va;v.pause();xa=0;q("html player unlocked")},function(){q("could not unlock html player")})}function c(a){a.stopPropagation();a.preventDefault();$("#unlkDlg").toggle(!1);
$("#unlkDlg button").off("mouseup touchend keydown");b()}ea=0;var d=Object.keys(a).filter(function(a){return!(a in mc)});d.length?(0==Q&&(d=[]),console.log("audioCtx.state: ",D.state),"suspended"==D.state||xa?($("#unlkDlg").toggle(!0),$("#unlkDlg button").on("mouseup touchend keydown",c).focus()):b()):ea=1}function F(a){a=a[0].link;a=a.replace("www.dropbox","dl.dropboxusercontent").split("?")[0];$("#wait").toggle(!0);q("link: "+a);$.get(a,"",null,"text").done(function(a,c){q("preload: "+c);da(a);
ya();$("#wait").toggle(!1)}).fail(function(a,c,d){$("#wait").append("\npreload failed: "+c)})}function da(a){var b=a.slice(0,4E3);0<=b.indexOf("pre_opt = {")&&(eval(a),a=abc_arr.join("\n"),b=a.slice(0,4E3));0<=b.indexOf("X:")?ma(a):-1==b.indexOf("<?xml ")?alert("not an xml file nor an abc file"):(a=$.parseXML(a),a=vertaal(a,{p:"f",t:1,u:0,v:3,m:2,mnum:0}),a[1]&&q(a[1]),ma(a[0]))}function fd(){var a=new FileReader;a.onload=function(b){da(a.result);ya()};var b=$("#fknp").prop("files")[0];b&&a.readAsText(b)}
function ma(a,b){E=a;var c=a.split("\n");0<e.hrz?c.splice(0,0,"%%singleline 1","%%maxshrink "+e.shrnk):c.splice(0,0,"%%measurenb 0");if(e.pw||e.hrz){var d=[],g,m;for(g=0;g<c.length;++g)m=c[g],0<=m.indexOf("$")&&(m=m.replace(/\$/g,"")),0==m.indexOf("I:linebreak")&&(m=c[g]),0==m.indexOf("V:")&&(m=m.replace(/snm="[^"]*"/,"")),0!=m.indexOf("%%page")&&0!=m.indexOf("%%left")&&0!=m.indexOf("%%right")&&(0==m.indexOf("%%scale")&&e.hrz||d.push(m));c=d;e.hrz?c.splice(1,0,"%%scale "+e.scl):(d=e.pw,g=(.03*d).toFixed(1),
m=(.01*d).toFixed(1),c.splice(1,0,"%%pagewidth "+d+"cm","%%leftmargin "+g+"cm","%%rightmargin "+m+"cm"))}a=c.join("\n");if(0<=a.indexOf("percmap")){var c={diamond:1,triangle:1,square:1,normal:1},d=['%%beginsvg\n<defs>\n<text id="x" x="-3" y="0">&#xe263;</text>\n<text id="x-" x="-3" y="0">&#xe263;</text>\n<text id="x+" x="-3" y="0">&#xe263;</text>\n<text id="normal" x="-3.7" y="0">&#xe0a3;</text>\n<text id="normal-" x="-3.7" y="0">&#xe0a3;</text>\n<text id="normal+" x="-3.7" y="0">&#xe0a4;</text>\n<g id="circle-x"><text x="-3" y="0">&#xe263;</text><circle r="4" class="stroke"/></g>\n<g id="circle-x-"><text x="-3" y="0">&#xe263;</text><circle r="4" class="stroke"/></g>\n<path id="triangle" d="m-4 -3.2l4 6.4 4 -6.4z" class="stroke" style="stroke-width:1.4"/>\n<path id="triangle-" d="m-4 -3.2l4 6.4 4 -6.4z" class="stroke" style="stroke-width:1.4"/>\n<path id="triangle+" d="m-4 -3.2l4 6.4 4 -6.4z" class="stroke" style="fill:#000"/>\n<path id="square" d="m-3.5 3l0 -6.2 7.2 0 0 6.2z" class="stroke" style="stroke-width:1.4"/>\n<path id="square-" d="m-3.5 3l0 -6.2 7.2 0 0 6.2z" class="stroke" style="stroke-width:1.4"/>\n<path id="square+" d="m-3.5 3l0 -6.2 7.2 0 0 6.2z" class="stroke" style="fill:#000"/>\n<path id="diamond" d="m0 -3l4.2 3.2 -4.2 3.2 -4.2 -3.2z" class="stroke" style="stroke-width:1.4"/>\n<path id="diamond-" d="m0 -3l4.2 3.2 -4.2 3.2 -4.2 -3.2z" class="stroke" style="stroke-width:1.4"/>\n<path id="diamond+" d="m0 -3l4.2 3.2 -4.2 3.2 -4.2 -3.2z" class="stroke" style="fill:#000"/>\n</defs>\n%%endsvg'],
r,z,n="default",f={"default":[]};g=a.split("\n");for(m=0;m<g.length;++m)if(r=g[m],0<=r.indexOf("I:percmap")&&(r=r.split(" "),z=r[4],z in c&&(z=z+"+,"+z),r="%%map perc"+n+" "+r[1]+" print="+r[2]+" midi="+r[3]+" heads="+z,f[n].push(r)),0<=r.indexOf("V:")&&(z=r.match(/V:\s*(\S+)/)))n=z[1],n in f||(f[n]=[]);for(n in f)d=d.concat(f[n]);for(m=0;m<g.length;++m)r=g[m],0<=r.indexOf("I:percmap")||(0<=r.indexOf("V:")||0<=r.indexOf("K:")?((z=r.match(/V:\s*(\S+)/))&&(n=z[1]),0==f[n].length&&(n="default"),d.push(r),
0<=r.indexOf("perc")&&-1==r.indexOf("map=")&&(r+=" map=perc"),0<=r.indexOf("map=perc")&&0<f[n].length&&d.push("%%voicemap perc"+n),0<=r.indexOf("map=off")&&d.push("%%voicemap")):d.push(r));a=d.join("\n")}gd(a);zb(a,b)}function hd(){if($("#twosys").prop("checked")){V=1;var a=-1==G?0:G;w.toggle(!1);w.eq(a).toggle(!0);w.eq(a+1).toggle(!0)}else V=0,w.toggle(!0);W()}function gd(a){function b(a){var b=[];a.forEach(function(a,c){b[a.st]?b[a.st].push(c):b[a.st]=[c];a.clef.clef_octave&&(Wa[c]=a.clef.clef_octave);
nc[a.st]=6*(a.stafflines||"|||||").length*(a.staffscale||1)});return b}var c,d="",g=[3,0,4,1,5,2,6],m=[0,2,4,5,7,9,11];za=a;X=[];Wa=[];c=new Abc({img_out:null,errmsg:function(a,b,c){d+=a+"\n"},read_file:function(a){return""},anno_start:null,get_abcmodel:function(a,c,d){function r(a,b){e[a]=[0,0,0,0,0,0,0];z[a]={};n[a]=b;var c=0<=b;(c?g.slice(0,b):g.slice(b)).forEach(function(b){e[a][b]+=c?1:-1})}var e={};d={"-2":-2,"-1":-1,0:0,1:1,2:2,3:0};var z={},n={},f={},x=c[0].meter.a_meter;oc=x.length?parseInt(x[0].top):
4;for(x=0;x<c.length;++x)r(x,c[x].key.k_sf),f[x]={};for(R=b(c);a;a=a.ts_next){var h,H,p,t,q=[];switch(a.type){case 14:x=a.tempo_notes.reduce(function(a,b){return a+b});Xa=a.tempo*x/384;break;case 10:p={t:a.time,nt:-1,dur:a.dur};q.push(p);X.push({t:a.time,ix:a.istart,v:a.v,dur:a.dur,ns:q,tmp:Xa});break;case 8:for(c=0;c<a.notes.length;++c)h=a.notes[c],H=h.pit+19,x=a.v,Wa[x]&&(H+=Wa[x]),p=Math.floor(H/7),t=H%7,void 0!=h.acc&&(z[x][H]=d[h.acc]),p=12*p+m[t]+(H in z[x]?z[x][H]:e[x][t]),Ab[p]=1,p={t:a.time,
nt:p,dur:a.dur},H in f[x]?(f[x][H].dur+=a.dur,0==h.ti1&&delete f[x][H]):(0!=h.ti1&&(f[x][H]=p),q.push(p));if(0==q.length)break;X.push({t:a.time,ix:a.istart,v:a.v,dur:a.dur,ns:q,tmp:Xa});break;case 5:r(a.v,a.k_sf);break;case 0:r(a.v,n[a.v]),X.push({t:a.time,ix:a.istart,v:a.v,bt:a.bar_type,tx:a.text})}}}});c.tosvg("play","%%play");c.tosvg("abc2svg",a);""==d&&(d="no error");q(d)}function zb(a,b){var c,d="",g="",m=0;p=b||0;G=-1;fa=b||0;Aa={};Ya=[];var r={},z,f,h=1E3,l=0;if(a){(function(){for(var b=a.split("\n"),
c=0;c<b.length&&!(0<=b[c].search(/^%%score/));++c);Y&&c==b.length&&(alert("Staff extraction only works with ABC files that have a %%score declaration"),Y=0);if(Y){Za=b[c];pc=c;var d="("+R[C].map(function(a){return a+1}).join(" ")+")";if(2==Y&&C+1 in R)var g=R[C+1].map(function(a){return a+1}),d="{"+d+"("+g.join(" ")+")}";b[c]="%%score"+Array(b[c].length-d.length-7+1).join(" ")+d}else Za&&(b[pc]=Za);a=b.join("\n")})();var k={img_out:function(a){-1!=a.indexOf("<svg")&&(Ya[m]=Object.keys(r),r={},m+=
1,z<h&&(h=z),f>l&&(l=f));d+=a},errmsg:function(a,b,c){g+=a+"\n"},read_file:function(a){return""},anno_start:function(a,b,d,g,e,n,l){if("note"==a||"rest"==a)g=c.ax(g).toFixed(2),e=c.ay(e).toFixed(2),l=c.ah(l),Aa[b]=[m,g,e,n,l];"bar"==a&&(e=c.ay(e),l=c.ah(l),e=Math.round(e+l),r[e]=1,f=c.ax(g),z=c.ax(0))},get_abcmodel:null};0==e.hrz&&(k.imagesize='width="100%"');c=new Abc(k);c.tosvg("abc2svg",a);""==g&&(g="no error");q(g);d&&($("#notation").html('<div id="leeg" style="height:500px">&nbsp;</div>'),$("#notation").append(d),
$("#notation").append('<div id="leeg" style="height:500px">&nbsp;</div>'),$("#leeg").click(function(){I?Ba():K(p)}),$("#notation").css("overflow-y",e.hrz?"hidden":"auto"),w=$("#notation svg"),k=$(".g"),Bb=k.length?k:w,w.children("title").remove(),qc(),rc(),V&&w.toggle(!1),w.click(function(a){var b,c,d,g,m;a.stopPropagation();g=(a.clientX+A.scrollLeft)*Ca;if(g<h+24||g>l)I?Ba():K(p);else{c=$("#notation").position().top-$("#notation").scrollTop();m=w.get().indexOf(this);d=(a.clientY-c-Da[m]+(V?Da[G]-
Da[0]:0))*Ca;c=Ya[m];for(a=0;a<c.length;a++)if(c[a]>d){a!=C&&Ea(Y?C:a);W(!0);break}for(a=0;a<t.length;++a)if(b=t[a].xy,c=b[0],d=b[1],b=b[3],!(c<m)&&g<parseFloat(d)+b){K(a);break}Fa()}}),Ea(C))}}function id(a){var b=0<p?t[p].t:0;t=[];$a={};var c=$("#chkmod").val(),d=X.filter(function(b){return!b.bt&&b.v in a}).map(function(a){return a.t});d.push(d[d.length-1]+1600);var g=d.shift(),m=[],e=[],f,n=[],h=[],l,q,k;for(f=0;f<X.length;++f){l=X[f];if(l.t==g){for(;l.t==g;)g=d.shift();n.push(h);h=[]}l.t<g&&h.push(l)}n.push(h);
var g=1,u=0,x=1,v=0,w=0,y=0;for(f=0;f<n.length;++f)for(h=n[f],e=m,m=[],d=0;d<h.length;++d){l=h[d];if(l.bt&&0==l.v){if(l.t in $a&&":"==l.bt[0])continue;if(1==g&&":"==l.bt[0]&&l.t>v){f=x-1;g=2;u+=l.t-v;m=e;break}2==g&&":"==l.bt[0]&&l.t>v&&(g=1);1==g&&":"==l.bt[l.bt.length-1]&&(x=f,v=l.t);w&&(l.tx||"|"!=l.bt)&&(w=0,u-=l.t-y);2==g&&"1"==l.tx&&(w=1,y=l.t)}if(w){m=e;break}l.bt?$a[l.t]=1:l.v in a||4==c?(q={},l.ns.sort(function(a,b){return b.nt-a.nt}),1==c?(m=m.concat(l.ns.slice(1)),k=l.ns[0],q[k.nt]=1,k=
k.dur):(l.ns.forEach(function(a){q[a.nt]=1}),k=Math.max.apply(Math,l.ns.map(function(a){return a.dur}))),Aa[l.ix]&&(t.push({t:l.t+u,xy:Aa[l.ix],ptc:q,dur:k,rst:e,tmp:l.tmp}),e=m)):l.ns.forEach(function(a){m.push({t:a.t+u,nt:a.nt,dur:a.dur})})}jd(m);ab=[];for(f=e=c=0;f<t.length;++f)ab.push(c),l=t[f],c+=60/l.tmp*(l.t-e)/384,e=l.t;for(p=0;p<t.length&&!(t[p].t>=b);++p);p==t.length&&--p;fa=p;L(0)}function jd(a){function b(a,b){var c=parseFloat(a[2]),d=a[4],g=parseFloat(b[2]),m=b[4],e=b.slice();e[2]=Math.min(c,
g);e[4]=Math.max(c+d,g+m)-e[2];return e}var c,d,g,m=[],e,f;Cb={};for(g=0;g<t.length;++g)d=t[g],e=Object.keys(d.ptc),f=e.map(function(a){return{mn:a,dur:d.dur}}),c&&c.t==d.t?(e.forEach(function(a){0<=a?(-1 in c.ptc&&(delete c.ptc[-1],c.xy=d.xy),c.ptc[a]=1):-1 in c.ptc&&(c.dur>d.dur?(c.dur=d.dur,c.xy=d.xy):d.xy=c.xy)}),c.xy=b(d.xy,c.xy),c.pbk=c.pbk.concat(f)):(d.pbk=f,c=d,m.push(d),Cb[d.t]=m.length-1);t=m;g=t[t.length-1];t.push({t:g.t+g.dur,xy:g.xy,ptc:g.ptc,dur:g.dur,rst:a})}function qc(){if(0!=w.length){var a=
$("#notation").position().top-$("#notation").scrollTop();Da=w.map(function(b,c){return $(c).position().top-a}).get()}}function rc(){if(0!=w.length){var a,b,c;c=w.get(0);a=c.getBoundingClientRect().width;try{b=c.viewBox.baseVal.width}catch(d){b=a}0==b&&(b=a);c=Bb.get(0).transform.baseVal;c=c.numberOfItems?c.getItem(0).matrix.a:1;Ca=b/c/a}}function W(a){if(!(0>G)){var b=$("#rollijn").offset().top+30-$("#notation").offset().top,c=Y?0:C,b=Math.round(Da[V?0:G]+(Ya[G][c]-nc[c])/Ca-b);b!=A.scrollTop&&(0<
e.hrz?(Ga&&(A.style["scroll-behavior"]="auto"),A.scrollTop=b):(Ga&&(A.style["scroll-behavior"]=a?"smooth":"auto"),Ga||!a?A.scrollTop=b:$(A).animate({scrollTop:b})))}}function sc(a){a=na.attr("x")/Ca-A.scrollLeft;var b=a-A.clientWidth/2;!Db||0==A.scrollLeft&&0>b||0>oa||0>a?(A.scrollLeft+=b,oa=1,Ha=0):(0<b?oa+=.005:0>b&&(oa-=.005),Eb+=oa+b/200,A.scrollLeft=Eb,Ha=requestAnimationFrame(sc))}function kd(a){var b=a.split(",");a=parseInt(b[0]);a=Cb[a];if(0<=a){b=b[1];M.value=b;var c=t[a];bb(c);if(0<Q){var d=
Z(),g=156.25/b;Object.keys(c.ptc).forEach(function(a){Ia(d,a,c.dur*g)});t[a+1].rst.forEach(function(a){Ia(d+(a.t-c.t)*g,a.nt,a.dur*g)})}}}function bb(a){var b,c,d,g,m;b=a.xy;c=b[0];d=b[1];g=b[2];m=b[3];b=b[4];c!=G&&($("#wijzer").remove(),Bb.eq(c).prepend(na),V&&(-1<G&&w.eq(G).toggle(!1),G+1<w.length&&w.eq(G+1).toggle(!1),w.eq(c).toggle(!0),c<w.length-1&&w.eq(c+1).toggle(!0)),G=c,W(!V));Fb=1;na.attr({x:d,y:g,width:m,height:b,fill:ga});0<e.hrz&&0==Ha&&(oa=1,Eb=A.scrollLeft,requestAnimationFrame(sc));
tc&&(cb.forEach(function(a){a.setAttribute("class","")}),cb=[],Object.keys(a.ptc).forEach(function(a){-1!=a&&(a=document.getElementById(uc[a]),a.setAttribute("class","neer"),cb.push(a))}))}function Gb(a,b){a.t!=Hb&&N.send(a.t+","+b);Hb=a.t}function Z(){return 1==Q?1E3*D.currentTime:(new Date).getTime()-performance.timing.navigationStart}function db(a,b){if(0!=Q&&1==Q&&ea){var c=a[0]&240,d=a[2],g=a[1];b/=1E3;128==c&&y(g,b);144==c&&(0<d?f(g,d,b):y(g,b));176==c&&64==g&&(64<=d?vb=1:(vb=0,Object.keys(Ua).forEach(function(a){y(a,
b)}),Ua={}));2==Q&&eb&&eb.send(a,b)}}function Ia(a,b,c){-1!=b&&(b=[144,b,70],db(b,a),b[2]=0,db(b,a+c-1))}function vc(){if(0>aa&&(K(-1),!e.nocnt))return;var a=fb,b=156.25/M.value,c=Z();a.pbk&&(Ib.checked||a.pbk.forEach(function(a){if(-1!=a.mn){var d=[144,a.mn,110];Ja({data:d});d[2]=0;db(d,c+a.dur*b-1)}}))}function Fa(a){a&&(ba=[],Jb=[],$("#error").html(0));Kb=J=0;Lb=[0,0,0,0,0,0,0,0,0,0];S=100;O.style.width=(gb?100:0)+"%";O.style.background="green";O.innerHTML="0";aa=-1}function wc(){var a,b,c=0,d,
g,e,f=ba.length;for(g=0;g<f;++g){d=ba[g];if(d=35>d)a?(b+=1,b>c&&(c=b)):b=1;a=d}e=ba.reduce(function(a,b){return a+b})/f;a=ba.reduce(function(a,b){return a+(b-e)*(b-e)},0);a=Math.sqrt(a/f);return{bln:c,avg:e,sdv:a}}function xc(a){if(0==ba.length)console.log("no data");else{var b=ba.map(function(a,b){return[b,a]}),c=Jb.map(function(a,b){return[b,a]}),d=$("body").height(),g=$("#perf");g.css("height",.8*d).toggle(!0);$.plot("#flot",[{label:"average",color:"#a0522d",data:b,lines:{show:!0},points:{show:!0},
yaxis:1},{label:"actual",color:"rgba(0,128,0,0.5)",data:c,bars:{show:!0,barWidth:.2,align:"center"},yaxis:2}],{yaxes:[{position:"left",font:{color:"#602010"}},{position:"right",font:{color:"rgba(0,128,0,1)"}}]});b=wc();$("#best").html("longest series notes < 35 msec: "+b.bln+", average error: "+b.avg.toFixed(1)+" msec, std.dev.: "+b.sdv.toFixed(1));g.on("click",function(){g.off();g.toggle(!1);a&&a.resolve("ok1")})}}function yc(a){Mb();$("#aud")[0].pause();ca=!1;var b=$.Deferred();if(pa){var c=$("#result");
c.on("click",function(){c.off();c.toggle(!1);xc(b)});a?c.html("<h3>bravo! you did it!</h3>"):c.html("<h3>... not good enough</h3>");a=wc();var d="<ul><li>Your longest series below 35 msec is: "+a.bln+" notes</li>",d=d+("<li>The average error was: "+a.avg.toFixed(1)+" msec. with a deviation of "+a.sdv.toFixed(1)+" msec.</li></ul>");c.append(d);c.toggle(!0)}else b.resolve("ok2");b.done(function(a){Fa();setTimeout(function(){K(fa)},1E3)})}function L(a,b,c){p+=a;0>p&&(p=0);var d=Z(),g=M.value,f=(d-Nb)/
Ob;a&&!Pb&&qa&&f<Qb&&f>zc&&(g=Math.round(g/(1<=f?1+.5*(f-1):1-.5*(1-f))),g=ha>g?ha:g,M.value=g,Ka=g/ra,v.playbackRate=Ka);var r=156.25/g,h=0<p&&!c?t[p-1].t:t[p].t,n=t[p],k=(n.t-h)*r;c=n.dur*r;if(a&&U){v.paused&&v.play();f=v.currentTime-ab[p];if(-.5>f||.5<f)v.currentTime=ab[p]+Va,f=0;k-=1E3*f;clearTimeout(Ac);Ac=setTimeout(function(){v.pause()},k+1E3)}var l=-1;(a||b)&&n.rst.forEach(function(a){var b=(a.t-h)*r;Ia(d+b,a.nt,a.dur*r);sa&&b!=l&&(l=b,setTimeout(function(){Gb(a,g)},b))});if(p==t.length-1)setTimeout(function(){yc(1)},
k);else{Pb=1==a&&n.ptc[-1];La||Pb?(Ib.checked||n.pbk.forEach(function(a){Ia(d+k,a.mn,a.dur*r)}),clearTimeout(Ma),Ma=setTimeout(function(){L(1)},k)):hb&&a&&(b=(n.t-h)*Bc,clearTimeout(Ma),Ma=setTimeout(function(){L(1)},b));b=k>c?k-.5*c:b=.5*k;var q=ib?k-b:0;0==a?(jb={},fb=n,ga="green",ta={},bb(n),U&&(v.currentTime=n.t/384*(60/Xa)+yb+Va),sa&&(Gb(n,g),Hb=-1)):(Cc=setTimeout(function(){jb={};fb=n;ga="green";Fb=0;aa=d+k;clearTimeout(Rb);Rb=setTimeout(function(){bb(n);if(!La)for(var a in ta)Sb(a);ta={}},
q)},b),sa&&setTimeout(function(){Gb(n,g)},k));Nb=d;Ob=k;ca&&!pa&&h in $a&&Tb();ra!=n.tmp&&(ra=n.tmp,e.sctmp&&(M.value=ra*Ka))}}function Mb(){clearTimeout(Ma);clearTimeout(Cc);clearTimeout(Rb)}function K(a){t.length&&("stop"==Na.value||0<=a?(Na.value="start",Dc(),La=0,Mb(),aa=-1,fa=p=0<=a?a:fa,cancelAnimationFrame(Ha),Ha=Db=0,L(0,0,1)):(Na.value="stop",Db=1,$("#start").blur(),ca||P?Dc():(Fa(1),P=e.nocnt?1:oc+1,kb=6==e.volgmod,$("#countin").html("<b>"+P+"</b>").toggle(!0),Tb())))}function ld(a){var b=
a.key;if(!I||"m"==b)switch(b){case "ArrowLeft":case "Left":L(-1);break;case "ArrowUp":case "Up":Ec(-1);break;case "ArrowRight":case "Right":vc();break;case " ":a.preventDefault();vc();break;case "ArrowDown":case "Down":Ec(1);break;case "c":K(-1);break;case "m":$("#mbar").click()}}function Sb(a){var b=fb;if(b){var c=Object.keys(b.ptc);if(0>aa&&(60==a||a in b.ptc)&&(K(-1),!e.nocnt))return;a in b.ptc?jb[a]=1:(Kb+=1,$("#error").html(Kb),ga="red");if(Object.keys(jb).length==c.length){ga="yellow";var d;
a=Math.abs(Z()-aa);Lb.push(a);b=Lb.shift();J+=(a-b)/10;gb?(100<J?S=0:35<J?S-=5:95>=S&&(S+=5),b=35>S?"red":75>S?"orange":"green",0==S&&(d=1),O.style.width=S+"%",O.style.background=b,O.innerHTML=J.toFixed(0)):(O.style.width=(100<J?100:J)+"%",b=35>J?"green":75>J?"orange":"red",O.style.background=b,O.innerHTML=a.toFixed(0),100<=J&&(d=1));ba.push(J);Jb.push(a);d&&pa?(yc(0),d=void 0):d=!La;d&&L(1)}Fb&&na.attr("fill",ga)}}function Fc(){for(var a=Z(),b=0;3>b;++b)Ia(a,60+2*b,300),a+=310}function Ja(a){var b=
a.data[0],c=a.data[1],d=a.data[2];254!=b&&(b&=240,128==b&&delete ta[c],144==b&&(0<d?"yellow"==ga?ta[c]=1:Sb(c):delete ta[c]),Gc&&db(a.data,Z()))}function md(a){q("MIDI ready! Listening to following input ports:");var b=0;a.inputs.forEach(function(a){a.onmidimessage=Ja;q(b+": "+a.name+', "'+a.manufacturer+'"');b++});q("The following output ports are present:");var c=$("#portsel");a=a.outputs;b=0;a.forEach(function(a){q(b+": "+a.name+', "'+a.manufacturer+'"');c.append('<option value="'+b+'">'+a.name+
"</option>");Hc.push(a);eb=a;b++})}function nd(a){q("Failed to get MIDI access - "+a)}function od(a){var b=$("#portsel").val();"synth"==b?(Q=1,a&&B(Ab)):"nosound"==b?Q=0:(Q=2,a=parseInt(b),eb=Hc[a]);Fc()}function Ea(a){a in R||(a=0);Mb();var b={};R[a].forEach(function(a){b[a]=1});3==$("#chkmod").val()&&a+1 in R&&R[a+1].forEach(function(a){b[a]=1});za&&id(b);C=a}function Ec(a){C+=a;0>C&&(C=0);C>=R.length&&(C=0);Ea(C)}function Ba(){I=1-I;$("#menu").toggle(I);$("#mbar").toggleClass("down",I);I&&setTimeout(function(){$("#fknp").focus()},
100)}function Ic(){Ub.style.fill="none";Vb=1;if(ca||P)lb=setTimeout(Tb,Wb)}function Dc(){P=0;kb=ca=!1;clearTimeout(lb);$("#countin").toggle(!1);Ic();U&&v.pause()}function Tb(){Ub.style.fill="red";if(Vb){var a=D.createBufferSource();a.buffer=Jc;a.connect(D.destination);a.start(0,.06,.16)}Vb=0;Wb=3E4/M.value;clearTimeout(lb);lb=setTimeout(Ic,Wb);0<P&&(--P,$("#countin").html("<b>"+P+"</b>"),1==P&&(aa=Z()),0==P&&($("#countin").toggle(!1),ca=e.metro,Nb=aa=Z(),kb?(kb=0,La=1,U&&v.play(),L(0,0,1)):$("#eenvoor").prop("checked")?
L(0,1):(Ob=0,U&&v.play(),t[p].ptc[-1]&&L(1))))}function lc(a,b){for(var c=atob(a),d=new ArrayBuffer(c.length),g=new Uint8Array(d),e=0;e<c.length;e++)g[e]=c.charCodeAt(e);D.decodeAudioData(d,function(a){b(a)},function(a){console.log("decode error: "+a);ea=0})}function pd(a){a.stopPropagation();$("#spkron").toggle();$("#spkrof").toggle();v.muted=!v.muted}function Kc(){Lc();da(abc_arr.join("\n"));ya();$("#wait").toggle(!1)}function qd(){var a,b="",c="",d,g,e,f="",k,n;$("#err").text("");a=window.location.href.replace("?dl=0",
"").split("?");if(d=a[0].match(/:\/\/([^/:]+)/))k=d[1];if(1<a.length){g=a[1].split("&");for(e=0;e<g.length;e++)a=g[e].replace(/d:(\w{15}\/[^.]+\.)/,"https://dl.dropboxusercontent.com/s/$1"),(d=a.match(/tmp=([\d.]*)/))?h.tempo=parseFloat(d[1]):(d=a.match(/stf=(\d+)/))?h.staff=parseInt(d[1]):(d=a.match(/mod=(\d+)/))?h.chkmod=parseInt(d[1]):(d=a.match(/fmd=(\d+)/))?h.volgmod=parseInt(d[1]):(d=a.match(/opa=(\d)/))?h.kbopa=parseInt(d[1]):(d=a.match(/line=(\d+)/))?h.line=parseInt(d[1]):(d=a.match(/pw=(\d+)/))?
h.pw=parseInt(d[1]):(d=a.match(/scl=([\d.]*)/))?h.scl=parseFloat(d[1]):(d=a.match(/hrz=(\d+)/))?h.hrz=parseInt(d[1]):(d=a.match(/tb=([\d.]*)/))?h.btime=parseFloat(d[1]):(d=a.match(/te=([\d.]*)/))?h.etime=parseFloat(d[1]):(d=a.match(/shrnk=([\d.]*)/))?h.shrnk=parseFloat(d[1]):(d=a.match(/lat=([\d]*)/))?h.lat=parseInt(d[1]):(d=a.match(/vol=([\d]*)/))?h.vol=parseInt(d[1]):"ip"==a&&k?h.ipadr=k:"ipm"==a&&k?(h.ipadr=k,h.mstr=1):"metro"==a?h.metro=1:"nocnt"==a?h.nocnt=1:"nodel"==a?h.delay=0:"keyb"==a?h.keys=
1:"ksh"==a?h.mark=1:"nosnd"==a?h.portsel="nosound":"nobar"==a?h.nobar=1:"nomenu"==a?h.nomenu=1:"extr"==a?h.extract=2:"extrg"==a?h.extract=3:"2ln"==a?h.twosys=1:"nocur"==a?h.nocur=1:"mute"==a?h.mute=1:"sctmp"==a?h.sctmp=1:"nosm"==a?Ga=!1:"ctrls"==a?h.ctrls=1:c=a,/(\.xml$)|(\.abc$)/.test(c)&&(b=c,c=""),/(\.mp3$)|(\.mp4$)|(\.ogg$)|(\.webm$)/.test(c)&&(f=c,c="");f&&(media_file=decodeURIComponent(f).replace("www.dropbox","dl.dropboxusercontent"));(c||b)&&$("#wait").toggle(!0);b?$.get(b,"",null,"text").done(function(a,
b){q("preload: "+b);da(a);ya();$("#wait").toggle(!1)}).fail(function(a,b,c){$("#wait").append("\npreload failed: "+b)}):c&&(0<=c.indexOf("dropbox.com")&&(c+="?dl=1"),$.getScript(c).done(function(a,b){q(", preload: "+b);Kc()}).fail(function(a,b,d){$("#wait,#err").append("\npreload failed: "+b+"\ntrying script tag ...");n=document.createElement("script");n.src=c;n.onload=function(){Kc()};n.onerror=function(){$("#wait").append("\npreload failed")};document.head.appendChild(n);document.head.removeChild(n)}))}return c||
b}function Mc(){for(var a in Xb){var b=$("#"+a),c=b.attr("type")||b[0].type;"checkbox"==c&&b.prop("checked",e[a]);"number"!=c&&"select-one"!=c||b.val(e[a])}}function ya(){function a(b){xb=1;v.removeEventListener("canplay",a);q("sufficient audio data loaded");$("#spkron").toggle(!0);ea&&$("#comp").toggle(!1)}for(var b in pre_opt)e[b]=pre_opt[b];for(b in h)e[b]=h[b];Mc();for(b in e)Oa(b,0);U=0;Va=e.lat/1E3;media_file?(yb=0<=e.btime?e.btime:0,v.src=media_file,e.ctrls&&(v.controls=!0),U=1,xb=0,v.addEventListener("canplay",
a)):xa=0;Nc=media_file||"";Pa.addEventListener("change",function(){Pa.blur();e.vol=Pa.value;tb=e.vol/25});Pa.value=e.vol;tb=e.vol/25;B(Ab);E&&(e.pw||e.hrz?ma(E,p):zb(za,p),Oa("begin",1));h.ipadr&&(rd(h.ipadr),h.mstr||w.off());demoDlg&&($("#demoDlg span").html(demoDlg),$("#demoDlg").toggle(!0),$("#demoDlg button").on("mouseup touchend keydown blur",function(a){a.stopPropagation();$("#demoDlg").toggle(!1);$("#demoDlg button").off("mouseup touchend keydown blur");$("#unlkDlg button").focus()}).focus())}
function sd(){if(E){var a='media_file = "'+(Nc||"")+'";\n',b=E.split("\n").map(function(a){return JSON.stringify(a)}),b="abc_arr = ["+b.join(",\n")+"];\n";e.staff=C+1;e.line=Math.round(100*$("#rollijn").position().top/$("body").height());e.begin=fa;var c="pre_opt = "+JSON.stringify(e)+";\n",a=a+c+b,b="data:text/plain;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(a)));$("#saveDlg pre").text(a);$("#saveDlg").toggle(!0);$("#div3 a").attr("href",b);$("#saveok").focus()}}function td(){pa=gb=
hb=!1;ha=0;$("#mtplab").toggle(!1);qa=1;Yb();e.volgmod=$("#volgmod").val();switch(e.volgmod){case "2":pa=!0;qa=0;break;case "3":gb=pa=!0;qa=0;break;case "4":hb=!0;$("#mtplab").toggle(!0);ha=e.mtpo;Bc=156.25/ha;var a=document.getElementById("delay");e.delay=a.checked=ib=!1;Yb();break;case "5":$("#mtplab").toggle(!0);ha=e.mtpo;break;case "6":qa=0;break;case "7":qa=0}Fa()}function Yb(){Qb=hb?10:3;zc=1/Qb}function Zb(){e.tempo=M.value;Ka=e.tempo/ra||1;v.playbackRate=Ka}function Oc(){e.mtpo=$("#mtpo").val();
ha=e.mtpo}function ud(a){a.stopPropagation();a.preventDefault();a.target.setAttribute("class","neer");a=$b[a.target.id];ac[a]=1;Ja({data:[144,a,110]})}function Pc(a){a.stopPropagation();a.preventDefault();a.target.setAttribute("class","");a=$b[a.target.id];a in ac&&(delete ac[a],Ja({data:[144,a,0]}))}function vd(){for(var a=[0,2,4,5,7,9,11,1,3,6,8,10],b=[],c=0;8>c;++c)for(var d=0;12>d;++d)b.push(12*c+a[d]+12);a=$("#toetsen rect");for(d=0;d<a.length;++d)c=$(a[d]),$b[a[d].id]=b[d],uc[b[d]]=a[d].id,
c.on("mousedown touchstart",ud),c.on("mouseup touchend",Pc),c.on("mouseleave",Pc),d==a.length/2&&c.css("fill","#9cc")}function Qc(){var a=$("#toetsen")[0].scrollWidth-$("body").width();$("#keyb").scrollLeft(a/2)}function ia(){var a=T&&0==bc?$("#keyb").height():$("#err").height(),b=$("body").height(),c=$("#info").height(),c=Math.round(100*c/b),a=Math.round(100*a/b);$("#notation").css("height",100-c-a+"%")}function Rc(a){var b=$("#toetsen svg"),c=b.width(),c=100*c/$("body").width();b.css("width",c+
a+"%");Qc()}function wd(){for(var a=$("#octaaf"),b=0;8>b;++b){var c=a.clone();c.find("rect").each(function(a,c){c.id+="-"+b});$("#toetsen").append(c)}vd()}function xd(a){if(T&&"zoom"==a.target.id){a.stopPropagation();a.preventDefault();var b="touchstart"==a.type,c=$("#zoom"),d=b?a.originalEvent.touches[0].clientX:a.pageX,e=b?a.originalEvent.touches[0].clientY:a.pageY,f=$("#keyb").height(),h=$("#keyb").scrollLeft();c.css("cursor","row-resize").toggleClass("spel",!0);c.on("mousemove touchmove",function(a){a.stopPropagation();
a.preventDefault();var c=b?a.originalEvent.touches[0].clientX:a.clientX;a=b?a.originalEvent.touches[0].clientY:a.clientY;Math.abs(a-e)>Math.abs(c-d)?(c=f+e-a,a=$("body").height(),c=Math.floor(100*c/a),$("#keyb").css("height",c+"%"),$("#zoom").css("bottom",c+"%"),$("#kblft").css("bottom",c+"%"),$("#kbrgt").css("bottom",c+"%")):$("#keyb").scrollLeft(h+d-c)});c.on("mouseup touchend mouseleave",function(a){a.stopPropagation();a.preventDefault();c.css("cursor","initial").toggleClass("spel",!1);c.off("mousemove touchmove mouseup touchend mouseleave");
ia()})}}function yd(a){if("info"==a.target.id||"error"==a.target.id||"mean"==a.target.id||""==a.target.id){a.stopPropagation();a.preventDefault();var b="touchstart"==a.type,c=$("#info"),d=b?a.originalEvent.touches[0].clientY:a.pageY,e=c.height();$("#notation").height();c.css("cursor","row-resize").toggleClass("spel",!0);c.on("mousemove touchmove",function(a){a.stopPropagation();a.preventDefault();var f=$("body").height();c.css("height",Math.floor(100*(e+(b?a.originalEvent.touches[0].clientY:a.clientY)-
d)/f)+"%");ia()});c.on("mouseup touchend mouseleave",function(a){a.stopPropagation();a.preventDefault();c.css("cursor","initial").toggleClass("spel",!1);c.off("mousemove touchmove mouseup touchend mouseleave");ia();W()})}}function Sc(a){function b(){d&&(Rc(c?-1:1),e=1,setTimeout(b,200))}var c=0,d=0,e=0;a=$(a);a.on("mousedown touchstart",function(a){a.stopPropagation();a.preventDefault();$(a.target).attr("class","spel");c="kblft"==a.currentTarget.id;d=1;e=0;setTimeout(b,300)});a.on("mouseup touchend mouseleave",
function(a){a.stopPropagation();a.preventDefault();if(d&&($(a.target).attr("class",""),d=0,!e)){a=c;var b=$("#octaaf").width(),f=$("#keyb"),g=f.scrollLeft();a?f.scrollLeft(g-b):f.scrollLeft(g+b)}})}function zd(a){a.preventDefault();var b="touchstart"==a.type,c=$("#rollijn");c.css("cursor","row-resize").toggleClass("spel",!0);c.on("mousemove touchmove",function(a){$("#notation").offset();a=b?a.originalEvent.touches[0].clientY:a.clientY;$("#rollijn").css("top",a-15+"px");W()});c.on("mouseup touchend mouseleave",
function(a){c.off("mousemove touchmove mouseup touchend mouseleave");c.css("cursor","initial").toggleClass("spel",!1)})}function q(a,b){b||(a+="\n");$("#err").append(a)}function rd(a){N?q("websocket already open"):(N=new WebSocket("ws://"+a+":8091/"),N.onmessage=function(a){a=a.data;"master"==a?($("#mbar").css("background","rgba(255,0,0,0.2)"),sa=1):sa||kd(a)},N.onerror=function(a){q("socket error (server inaccessible?)");N=null},N.onopen=function(a){$("#mbar").css("background","rgba(0,255,0,0.2)");
h.mstr&&N.send("master");q("connection opened")},N.onclose=function(a){$("#mbar").css("background","");q("connection closed: "+a.code);N=null;sa=0})}function Lc(){e={};za="";for(var a in Xb)e[a]=Xb[a];for(a in Tc)e[a]=Tc[a];Mc();for(a in e)Oa(a,0)}function Oa(a,b,c){switch(a){case "tempo":M.value=e.tempo;Zb();break;case "mtpo":Oc();break;case "chkmod":E&&b&&Ea(C);break;case "echo":Gc=e[a];break;case "delay":ib=e[a];break;case "volgmod":td();break;case "portsel":od(c);break;case "keys":T=$("#keys").prop("checked");
$("#keyb").toggle(T);$("#zoom").toggle(T);$("#kblft").toggle(T);$("#kbrgt").toggle(T);$("#rek").toggle(T);T?Rc(0):Qc();ia();break;case "mark":tc=e[a];cb.forEach(function(a){a.setAttribute("class","")});t.length&&bb(t[p]);break;case "kbopa":bc=e[a]/10;$("#keyb").css("opacity",1-bc);ia();break;case "pw":e.pw=parseFloat(e[a]);5>e.pw&&(delete e.pw,$("#pw").val(""));E&&b&&ma(E);break;case "scl":e.scl=parseFloat(e[a]);if(.1>e.scl||2<e.scl)delete e.scl,$("#scl").val("");E&&b&&ma(E);break;case "metro":ca&&
(ca=!1);break;case "extract":Y=$("#extract").val()-1;0==Y&&(Za="");E&&b&&zb(za);break;case "twosys":E&&hd();break;case "micuse":e.micuse?Ad():cc();break;case "gain":Uc();break;case "drempel":Bd();break;case "minlev":Vc();case "bass":ja=$("#bass").prop("checked")?1024:512;ka&&Wc();break;case "staff":C=e.staff-1;E&&b&&Ea(C);break;case "line":$("#rollijn").css("top",e.line+"%");W();break;case "begin":p=fa=e.begin;E&&b&&L(0);break;case "nocur":na.attr("fill-opacity",e.nocur?0:.5);break;case "drpuse":Cd();
break;case "nobar":$("#info").toggle(!1);$("#err").toggle(!1);$("#notation").css("height","100%");W();break;case "nomenu":$("#btns").toggle(!1);break;case "sctmp":M.value=ra;Zb();break;case "hrz":b&&(e.hrz=e.hrz?50:0),$("#pwlbl").toggle(0==e.hrz),$("#scllbl").toggle(0<e.hrz),E&&b&&ma(E)}}function dc(a){a=$(this).attr("type")||this.type;var b=$(this).attr("id");"checkbox"==a&&(e[b]=$(this).prop("checked"));if("number"==a||"select-one"==a||"range"==a)e[b]=$(this).val();Oa(b,1,1)}function Cd(){function a(a){$("#drpuse").prop("checked",
!a);$("#drpuse").attr("disabled",a);$("#drplbl").css("color",a?"#aaa":"#000")}function b(){var a=$("#drpuse").prop("checked");$(".dropbox-dropin-btn").css("display",a?"inline-block":"none");$("#fknp").css("display",a?"none":"inline-block")}if("undefined"==typeof Dropbox){a(!0);var c;$.ajax({url:"https://www.dropbox.com/static/api/2/dropins.js",dataType:"script",cache:!0}).done(function(){a(!1);Dropbox.init({appKey:"ckknarypgq10318"});c=Dropbox.createChooseButton({success:F,extensions:[".xml",".abc",
".js"],cancel:function(){},linkType:"preview",multiselect:!1});$("#flbl").append(c);b()})}else b()}function Xc(a){var b,c,d,e,f=0,h=-1,k,n,p=Math.floor(a.length/2),l=0,q=Infinity;la=Array(p);n=p/2;for(c=3;c<p;c++){e=0;k=Math.floor(n-c/2);a[k]>l&&(l=a[k]);for(b=k;b<k+p;b++)d=a[b]-a[b+c],e+=d*d;f+=e;e*=(c-2)/f;la[c]=e;if(e<q)q=e,h=c;else if(.1>q)break}c=la[h+1];b=la[h];a=la[h-1];return{period:h+((a-c)/(c-2*b+a)/2||0),diff:q,max:l}}function Yc(a){ka.getFloatTimeDomainData(ua);var b=Xc(ua),c=b.period/
a,c=1.06>c&&.94<c;if(b.diff<Qa&&0<b.diff&&b.max>ec||.65>b.diff&&c){var d=D.sampleRate/b.period;c||Sb(Math.round(69+12*Math.log(d/440)/Math.log(2)));a=b.period}else a=1;mb=setTimeout(function(){Yc(a)},0)}function Vc(){var a=parseInt(e.minlev),b=2.5*(40+a),c=$("#mxlvl").width();$("#levmrk").css("width",c*b/100+"px");ec=Math.pow(10,a/20);$("#mval").html(a)}function Bd(){var a=parseFloat(e.drempel);Qa=a/10;$("#dval").html(a);Zc()}function Uc(){var a=parseFloat(e.gain);Ra&&(Ra.gain.value=Math.pow(10,(a+
1)/2-3));$("#gval").html(a)}function Wc(){ka.fftSize=4*ja;ua=new Float32Array(ka.frequencyBinCount)}function cc(){Sa&&(Sa.getAudioTracks().forEach(function(a){a.stop()}),fc.disconnect(),Sa=null,cancelAnimationFrame(nb),clearTimeout(mb));$("#micuse").prop("checked",!1);$("#micKnop").css("background","");$("#micon").css("color","#666")}function Ad(){function a(a){Sa=a;fc=D.createMediaStreamSource(a);Ra=D.createGain();ka=D.createAnalyser();Wc();fc.connect(Ra);Ra.connect(ka);Uc();$c();$("#micKnop").css("background",
"orange");$("#micon").css("color","#c33");a=document.getElementById("delay");e.delay=a.checked=ib=!1}function b(a){alert("Can not access the microphone!\n"+a.name+": "+a.message);cc()}if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia({audio:!0}).then(a)["catch"](b);else{navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;try{navigator.getUserMedia({audio:!0},a,b)}catch(c){alert("getUserMedia() not supported by your browser -> no microphone\n"+
c.name+": "+c.message),cc()}}}function Dd(){var a=document.getElementById("micuse");e.micuse=a.checked=!a.checked;Oa("micuse",0)}function $c(){Sa&&(cancelAnimationFrame(nb),clearTimeout(mb),ad?nb=requestAnimationFrame(function(){bd(1)}):mb=setTimeout(function(){Yc(1)},0))}function cd(a){$("#tuner").toggle(a);a&&($("#micuse").focus(),Vc());I&&Ba();ad=a;$c()}function bd(a){var b=performance.now();ka.getFloatTimeDomainData(ua);var c=Xc(ua),d=c.period/a;a=1.06>d&&.94<d;d=69+12*Math.log(D.sampleRate/c.period/
440)/Math.log(2);b=(performance.now()-b).toFixed(2);if(c.diff<Qa&&0<c.diff&&c.max>ec||.65>c.diff&&a){a=c.period;a=Math.round(d);var e=Ed[a%12]+Math.floor(a/12);ob.innerHTML=e;d=Math.round(100*(d-a));gc.push(d);va+=(d-gc.shift())/30;Ta.innerHTML=Math.round(va);0<=va?(Ta.style.width="50%",pb.style.width=va+"%"):(Ta.style.width=50+va+"%",pb.style.width=-va+"%");wa.style.background="#cc0";ob.style.background="#cc0"}else e="---",a=1,wa.style.background="orange",ob.style.background="none";Zc();k.strokeStyle=
"green";k.beginPath();k.moveTo(0,256-128*la[0]);d=ja/512;for(a=1;a<ja;a+=d)k.lineTo(a/d,256-128*la[a]);k.stroke();k.beginPath();k.moveTo(c.period/d,256);k.strokeStyle="red";k.lineTo(c.period/d,245);k.stroke();c=20*Math.log10(c.max);hc=2.5*(40+c);hc>qb?(qb=hc,wa.innerHTML=c.toFixed(0),rb=ua.slice()):--qb;wa.style.width=qb+"%";b>ic&&(ic=b);20==dd++&&(sb.style.width=Math.min(10*b,100)+"%",sb.innerHTML=b,dd=ic=0);if(rb){k.strokeStyle="grey";k.beginPath();k.moveTo(0,128-32*rb[0]);d=ja/512;for(a=1;a<ja;a+=
d)k.lineTo(a/d,128-32*rb[a]);k.stroke()}nb=requestAnimationFrame(function(){bd(1)})}function Zc(){k.clearRect(0,0,512,256);k.beginPath();k.moveTo(0,256-128*Qa);k.strokeStyle="blue";k.setLineDash([5,3]);k.lineTo(512,256-128*Qa);k.stroke();k.setLineDash([])}function Fd(){var a=document.body,b=a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen,c=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen;b&&c&&($("#fscr").prop("checked")?b.call(a):c.call(document))}
function Gd(){var a;navigator.bluetooth.requestDevice({filters:[{services:["03b80e5a-ede8-4b33-a751-6ce34ec4c700"]}]}).then(function(a){var b=a.gatt.connect();q("BLE Connected: "+a.name+", "+a.id.substring(0,5)+"...");return b}).then(function(a){return a.getPrimaryService("03b80e5a-ede8-4b33-a751-6ce34ec4c700")}).then(function(a){return a.getCharacteristic("7772e5db-3868-4112-a1a9-f2669d106bf3")}).then(function(b){a=b;return a.startNotifications()}).then(function(b){q("Midi notifications started");
a.addEventListener("characteristicvaluechanged",Hd)})["catch"](function(a){q(a.toString())})}function Hd(a){var b=a.target.value.getUint8(2),c=a.target.value.getUint8(3);a=a.target.value.getUint8(4);Ja({data:[b,c,a]})}var Aa={},t=[],p=0,G=-1,Da,Ca,eb,Hc=[],jb={},Xa=60,za,Q=0,La=0,Nb,Ob,X,I,R,fa=0,Gc=1,ba,Jb,ib=1,T=0,A,Ga,Ma,Cc,Rb,Ac,jc,ta,Na,na=$(document.createElementNS("http://www.w3.org/2000/svg","rect"));na.attr({id:"wijzer",fill:"green","fill-opacity":"0.5",width:"0"});var D,kc=[],ub=[],vb=0,
Ua={},wb,mc={},Ab={},Aa={},t=[],Wa=[],Ya=[],nc=[];X=[];var pa=0,gb=0,S=100,Kb,J,Lb,qa=0,O,M,Ub,Ib,Jc,P=0,oc=4,Vb=1,fb,aa=0,Fb,ga,hb=0,ha=0,Bc,Qb,zc,bc=0,$b={},uc={},ac={},w=[],Bb=[],cb=[],tc=0,Y=0,Za,pc=0,C=0,V=0,Pb,N,sa=0,Cb={},Hb,kb=0,E,$a,e,ad=0,ec,Sa,fc,ka,ua,Ra,ja,la,sb,ic=0,dd=0,Qa,k;ja=512;for(var wa,hc=0,qb=-100,ob,pb,Ta,va=0,rb,mb,nb,Ed="C ;C#;D ;D#;E ;F ;F#;G ;G#;A ;A#;B ".split(";"),gc=[],ed=0;30>ed;ed++)gc.push(0);var h={},Xb={delay:1,eenvoor:0,metro:0,keys:0,mark:0,twosys:0,mute:0,volgmod:6,
chkmod:2,extract:1,portsel:"synth",tempo:60,kbopa:0,pw:0,scl:1,gain:5,drempel:1,minlev:-18,bass:0,mtpo:20,hrz:0,vol:50,nocur:0},Tc={staff:1,line:30,begin:0,sctmp:0,btime:0,etime:0,nocnt:0,ctrls:0,shrnk:0,lat:0},tb=2,ea,xa,xb,Va,v,Pa,yb=.1,U,Ka,ra,Nc,ab,Eb=0,oa=0,Ha=0,Db=0,Wb,lb=0,ca;$(document).ready(function(){v=document.getElementById("aud");Pa=document.getElementById("vol");A=document.getElementById("notation");Ga=CSS.supports("scroll-behavior","smooth");Na=document.getElementById("start");$("#verlab").html("Version: "+
follow_VERSION);$("body").keydown(ld).click(function(){I&&Ba()});$("#kwart").click(function(){e.metro=1;$("#metro").prop("checked",1);K(-1)});$("#kwart").append($("#mtrsvg"));$("#tempo").change(Zb);$("#micon").click(Dd);$("#start").click(function(){K(-2)});$("#spkr").append($("#spkron").toggle(!1));$("#spkr").append($("#spkrof").toggle(!1)).click(pd);$("#menu").toggle(!1);I=0;$("#menu").click(function(a){a.stopPropagation()});$("#mbar").click(function(a){a.stopPropagation();Ba()});$("#menu select").change(dc);
$("#menu input").change(dc);$("#tuner input").change(dc);$("#zoom").on("mousedown touchstart",xd);$("#rollijn").on("mousedown touchstart",zd);$("#info").on("mousedown touchstart",yd);$(window).resize(function(){var a=V;a&&$("#twosys").click();qc();rc();ia();W();a&&$("#twosys").click()});$("#fknp").change(fd);$("#testport").on("mousedown",Fc);$("#stats").click(function(){xc(0)});$("#save").click(sd);$("#saveok").click(function(){$("#saveDlg").toggle()});$("#micKnop").click(function(){cd(!0)});$("#ble").click(Gd);
$("#mtplab").change(Oc);$("#micOk").click(function(){cd(!1)});wa=document.querySelector("#mxlvl > div");wa.innerHTML="0";pb=document.querySelector("#cents > div");pb.innerHTML="&nbsp;";Ta=document.querySelector("#cents > span");Ta.style.width="50%";ob=document.getElementById("noot");sb=document.querySelector("#anatijd > div");sb.innerHTML="0";k=document.getElementById("graaf").getContext("2d");Sc("#kblft");Sc("#kbrgt");O=$("#mean > div")[0];$("#error");M=$("#tempo")[0];Ib=$("#mute")[0];Ub=$("#path9868")[0];
Fa(1);var a=window.AudioContext||window.webkitAudioContext;(D=void 0!=a?new a:null)||alert("Your browser does not support the Web Audio API");lc("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yE2S0tyZVivRopSXQGhTEhUhrKy7MrjXjaFIEjX//ppWN6hxW8rShnYym/ytlBCipejyoBI5S6sunmXcqS0CsGFKxqM5dAJ1IWRStJ30SS6VsMi1wsgexC7hVLmpVeu9iV0q2osru+oamEzp//PEZHUOIQ0hHz0iLhvZ7jl2YMsmXYCpYRlkySmBaQj0+Hk4LS3zlx2Werj37ZkxWrUwlPNdbe6sPUhxMpeTKURFUf63LMdjAKKm/apXob0KyG9TfmeVlDrWU+e//LNf//HNNCqQKKmRjTIsSNCyB7DAVImRZIxpoc00KpAoqZGVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUNrmJJJLQwNA8o//PEZAoFmAb2fwwjARIh1dGeMMSeWFU1inUzqFtbUf+sU/xfrb/9Yp/+tv/7P/xUW/+sUb/8VFgCV5cdsFABhJlxbOUVcJ48oIFUMmWUGEFkZNZ2UjWWzI+hgYME4g+wHY5DlMqIrfgjjOVP//ymVUXMFDKLB40FRRtQsK///8UVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",
function(a){Jc=a;console.log("E3 decoded")});Yb();xa=1;Lc();"requestMIDIAccess"in navigator?navigator.requestMIDIAccess().then(md,nd):($("#notation").append('<br>Web MIDI API is not supported in this browser: try Chrome or Opera (on iOS you can try the <a href="https://apps.apple.com/us/app/web-midi-browser/id953846217">Web Midi Browser</a>)'),q('Web MIDI API is not supported in this browser: try Chrome or Opera (on iOS you can try the <a href="https://apps.apple.com/us/app/web-midi-browser/id953846217">Web Midi Browser</a>)'));
$("#ble").prop("disabled",!("bluetooth"in navigator));qd()||ya();wd();36>$("#info").height()&&(a=$("body").height(),$("#info").css("height",Math.floor(3600/a)+"%"),ia());$("#fscr").on("change",Fd);$("body").on("fullscreenchange webkitfullscreenchange mozfullscreenchange",function(){var a=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement;$("#fscr").prop("checked",null!=a)});A.addEventListener("touchstart",function(a){jc=a.touches[0].clientX});A.addEventListener("touchmove",
function(a){"stop"==Na.value&&K(p);e.hrz&&(a.stopPropagation(),a.preventDefault(),A.scrollLeft-=a.touches[0].clientX-jc,jc=a.touches[0].clientX)})})})();
